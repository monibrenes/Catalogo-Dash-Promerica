<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat√°logo Dashboards Promerica</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root{
      --green-600:#006338; --green-400:#61BF1A; --gray-500:#A6A6A6; --blue-800:#003E89; --teal-400:#69C7C7; --red-700:#A20000; --orange-600:#C35A00; --lime-500:#B9C301; --bg:#FFFFFF; --fg:#000000; --accent:#61BF1A;
      --card-bg:#FFFFFF; --card-border:#E6E6E6; --muted:#5A5A5A; --chip-bg:#F5F5F5; --chip-fg:#222; --shadow:0 8px 24px rgba(0,0,0,.08);
      --kbd-bg:#F2F2F2; --kbd-fg:#111; --input-bg:#FFFFFF; --input-border:#DADADA;
    }
    @media (prefers-color-scheme: dark){
      html[data-theme="dark"]:root{
        --bg:#0B0F0C; --fg:#F2F2F2; --card-bg:#111511; --card-border:#1F291F; --muted:#B7B7B7; --chip-bg:#1A231B; --chip-fg:#EDEDED; --shadow:0 12px 28px rgba(0,0,0,.45); --kbd-bg:#1E1E1E; --kbd-fg:#EDEDED; --input-bg:#121712; --input-border:#2A2F2A;
      }
    }
    html,body{height:100%}
    body{margin:0; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--fg); line-height:1.35;}
    .container{max-width:1280px; margin:0 auto; padding:24px;}

    header{background:var(--green-600); color:#fff;}
    .header-inner{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:18px 24px;}
    .brand{display:flex; align-items:center; gap:12px;}
    .title-wrap{display:flex; flex-direction:column}
    h1{margin:0; font-size: clamp(22px, 3.2vw, 32px); font-weight:700; line-height:1.1;}
    .gradient-title{background:linear-gradient(90deg, var(--green-400), var(--lime-500)); -webkit-background-clip:text; background-clip:text; color:transparent;}

    .content{display:grid; grid-template-columns: 1fr; gap:24px;}

    .intro-box{position:relative; border:1px solid rgba(97,191,26,.35); border-radius:16px; padding:16px; box-shadow:var(--shadow); background:#f4f9ef; background: color-mix(in srgb, var(--green-400) 12%, var(--bg));}
    html[data-theme="dark"] .intro-box{ border-color:rgba(97,191,26,.45); background: color-mix(in srgb, var(--green-400) 7%, var(--bg)); }
    .intro-head{display:flex; gap:12px; align-items:flex-start; margin-bottom:10px}
    .intro-ico{flex:0 0 auto; color:var(--green-600)}
    .intro-text strong{display:block; margin-bottom:2px}

    .searchbox{position:relative; margin-top:4px}
    .searchbox input{width:100%; font-size:16px; padding:14px 44px 14px 44px; border:1px solid var(--input-border); border-radius:12px; background:var(--input-bg); color:var(--fg); box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .searchbox input:focus{outline:2px solid transparent; border-color:var(--green-400); box-shadow:0 0 0 3px rgba(97,191,26,.25)}
    .searchbox .icon{position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.9}
    .searchbox .clear{position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; opacity:.8}
    .suggestions{position:absolute; z-index:8; top: calc(100% + 6px); left:0; right:0; background:var(--card-bg); border:1px solid var(--card-border); border-radius:12px; box-shadow:var(--shadow); max-height:280px; overflow:auto; display:none}
    .suggestions[aria-expanded="true"]{display:block}
    .suggestions ul{margin:0; padding:6px; list-style:none}
    .suggestions li{padding:10px 12px; border-radius:8px; cursor:pointer}
    .suggestions li[aria-selected="true"], .suggestions li:hover{background:var(--chip-bg)}

    .filters{display:flex; flex-direction:column; gap:10px; margin-top:8px}
    .chip-row{display:flex; flex-wrap:wrap; gap:8px}
    .chip{border:1px solid var(--card-border); background:var(--chip-bg); color:var(--chip-fg); padding:8px 12px; border-radius:999px; font-size:12px; cursor:pointer; user-select:none}
    .chip[aria-pressed="true"]{background:var(--accent); border-color:var(--accent); color:#0E2A0E; font-weight:700}

    .grid{display:grid; grid-template-columns: repeat(1, minmax(0,1fr)); gap:16px}
    @media(min-width:650px){.grid{grid-template-columns: repeat(2, minmax(0,1fr));}}
    @media(min-width:980px){.grid{grid-template-columns: repeat(3, minmax(0,1fr));}}

    .card{background:var(--card-bg); border:1px solid var(--card-border); border-radius:16px; padding:18px 40px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:12px;}
    .card.inactivo{filter:grayscale(0.4); opacity:0.68}
    .card-header{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .card-title{font-size:16px; font-weight:700; margin:0}
    .badge{display:inline-flex; align-items:center; gap:6px; font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid transparent;}
    .badge.activo{background:rgba(97,191,26,.15); color:var(--green-400); border-color:rgba(97,191,26,.35)}
    .badge.inactivo{background:#2b2b2b12; color:#888; border-color:#8883}

    .meta{display:flex; flex-direction:column; gap:6px; font-size:12px; color:var(--muted)}
    .meta-line{display:block}
    .tags{display:flex; gap:6px; flex-wrap:wrap}
    .tag{font-size:11px; padding:4px 8px; border-radius:999px; background:var(--chip-bg); color:var(--chip-fg); border:1px solid var(--card-border)}
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .btn{appearance:none; border:1px solid transparent; border-radius:14px; padding:10px 14px; font-weight:600; cursor:pointer; transition:transform .04s ease, box-shadow .2s ease, background .2s ease; box-shadow:0 2px 0 rgba(0,0,0,.08);}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn-primary{background:#0c8c50; color:#fff; border-color:#0a804a}
    .btn-primary:focus{outline:2px solid #fff; outline-offset:2px}
    .btn-sm{font-size:12px; padding:8px 10px; border-radius:10px}
    .btn-ghost{background:transparent; color:var(--fg); border:1px solid var(--input-border)}
    .btn-ghost:hover{background:var(--chip-bg)}

    footer{margin-top:12px; padding:16px 24px; font-size:12px; color:var(--muted)}

    .footnote{background:var(--green-600); color:#fff;}
    .footnote-inner{max-width:1280px; margin:0 auto; padding:10px 24px; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;}

    kbd{background:var(--kbd-bg); color:var(--kbd-fg); border-radius:6px; padding:2px 6px; border:1px solid var(--card-border); font-size:12px}
    .empty{background:var(--card-bg); border:1px solid var(--card-border); border-radius:16px; padding:24px; text-align:center}
    .suggested{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    .loader{display:none; font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand" aria-label="Marca Promerica">
        <div class="title-wrap">
          <h1><span class="gradient-title">Cat√°logo Dashboards Promerica</span></h1>
          <small class="loader" id="loader">Cargando cat√°logos desde Excel‚Ä¶</small>
        </div>
        <div>
          <label for="fileInput" class="sr-only">Cargar Excel</label>
          <input id="fileInput" type="file" accept=".xlsx,.xls" />
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="content" aria-live="polite">
      <section>
        <div class="intro-box" id="intro" role="region" aria-label="B√∫squeda">
          <div class="intro-head">
            <div class="intro-ico" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 15h-2v-2h2Zm0-4h-2V7h2Z"/></svg>
            </div>
            <div class="intro-text" id="searchHelp">
              <strong>¬øQu√© tipo de visualizaci√≥n necesita?</strong>
              <span>Los datos se cargan desde un Excel (solo registros <em>Activos</em>).</span>
            </div>
          </div>
          <div class="searchbox">
            <svg class="icon" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <input id="searchInput" type="search" placeholder="Buscar por nombre, dominio o tag" aria-label="Buscar dashboards" aria-describedby="searchHelp" autocomplete="off" />
            <button id="clearSearch" class="clear" aria-label="Limpiar b√∫squeda" title="Limpiar">
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <div id="suggestions" class="suggestions" role="listbox" aria-expanded="false" aria-label="Sugerencias de b√∫squeda"><ul></ul></div>
          </div>
        </div>

        <div class="filters" aria-label="Filtros">
          <div class="chip-row" id="chipRow" role="group" aria-label="Dominios"></div>
        </div>

        <div id="grid" class="grid" role="grid" aria-label="Resultados"></div>
        <div id="emptyState" class="empty" style="display:none">
          <div style="font-weight:700; margin-bottom:6px">No encontramos una coincidencia</div>
          <div>Pruebe con t√©rminos similares o use las sugerencias</div>
          <div id="nearTerms" class="suggested" aria-label="Sugerencias cercanas"></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="container">
    Este cat√°logo es de uso interno del Banco Promerica. No comparta enlaces fuera de la organizaci√≥n.
  </footer>

  <div class="footnote" role="contentinfo" aria-label="Cr√©ditos">
    <div class="footnote-inner">
      <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 15h-2v-2h2Zm0-4h-2V7h2Z"/></svg>
      <span>Desarrollado por <strong>Gerencia de Data y Analytics</strong></span>
    </div>
  </div>

  <script>
  // ====== CONFIG ======
  // Opci√≥n A: dejar un Excel accesible por URL (mismo dominio / CDN)
  // Ejemplo: "/data/catalogo_dashboards.xlsx"
  const EXCEL_URL = ""; // <- coloque aqu√≠ la URL del Excel si aplica
  const EXCEL_SHEET_NAME = null; // si quiere forzar una hoja espec√≠fica, ponga el nombre. Si es null toma la primera

  // ====== Estado & helpers ======
  let DASH_DATA = [];
  let DOMAINS = [];

  const SYNONYMS = { dashboard:["dash","tablero","panel"], orquestador:["orquestrador","orchestrator"], "master analytics":["mast analitics","master analitics","master analitycs"], promerica:["banco promerica","el banco"] };
  const CORRECTIONS = { analitics:"analytics", aceder:"acceder", dashboar:"dashboard" };

  const LS_KEYS = { q:"catdash.q", cat:"catdash.cat" };
  const state = { q:"", category:"", onlyActive:true, detected:[] };

  const normalizeText = (s)=> (s||"").toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim().replace(/\s+/g,' ');
  function levenshtein(a,b){ a=normalizeText(a); b=normalizeText(b); const m=a.length,n=b.length; if(m===0) return n; if(n===0) return m; const dp=new Array(n+1); for(let j=0;j<=n;j++) dp[j]=j; for(let i=1;i<=m;i++){ let prev=i-1; dp[0]=i; for(let j=1;j<=n;j++){ const tmp=dp[j]; const cost=a[i-1]===b[j-1]?0:1; dp[j]=Math.min(dp[j]+1, dp[j-1]+1, prev+cost); prev=tmp; } } return dp[n]; }
  function expandSynonyms(tokens){ const expanded=new Set(tokens); for(const [key,vals] of Object.entries(SYNONYMS)){ const all=[key,...vals].map(normalizeText); for(const t of tokens){ if(all.some(x=> x.includes(t)||t.includes(x))){ all.forEach(x=>expanded.add(x)); } } } return Array.from(expanded); }

  function applyCorrections(q){ return normalizeText(q).split(' ').map(p=> CORRECTIONS[p]||p).join(' '); }
  function tokenize(q){ return normalizeText(q).split(' ').filter(t=>t); }

  function scoreItem(item,tokens){ if(tokens.length===0) return {score:0,reason:[]}; const fields={ nombre:normalizeText(item.nombre), desc:normalizeText(item.descripcion||""), cat:normalizeText(item.dominio||item.categoria||""), tags:(item.tags||[]).map(normalizeText)}; let score=0; const reason=[]; for(const t of tokens){ if(fields.nombre.includes(t)){score+=5;reason.push('n:'+t);} if(fields.desc.includes(t)){score+=2;reason.push('d:'+t);} if(fields.cat.includes(t)){score+=3;reason.push('c:'+t);} if(fields.tags.some(x=>x.includes(t))){score+=3;reason.push('g:'+t);} if(fields.nombre.split(' ').some(w=>w.startsWith(t))) score+=2; if(fields.tags.some(x=> x.split(' ').some(w=>w.startsWith(t)))) score+=1; const th=Math.max(1,Math.floor(t.length*0.25)); const near=[fields.nombre,fields.desc,fields.cat,...fields.tags].some(v=> levenshtein(t,v)<=th); if(near){score+=1;reason.push('~:'+t);} } return {score,reason}; }

  function persist(){ try{ localStorage.setItem(LS_KEYS.q,state.q); localStorage.setItem(LS_KEYS.cat,state.category);}catch(e){} }
  function restore(){ try{ state.q=localStorage.getItem(LS_KEYS.q)||''; state.category=localStorage.getItem(LS_KEYS.cat)||''; }catch(e){} state.onlyActive=true; if(state.category && !DOMAINS.includes(state.category)) state.category=''; }

  function buildChips(){ const chipRow=document.getElementById('chipRow'); chipRow.innerHTML=''; const cats=DOMAINS.slice().sort((a,b)=>a.localeCompare(b)); const all=['Todos',...cats]; all.forEach(cat=>{ const btn=document.createElement('button'); btn.className='chip'; const value=cat==='Todos'?'' : cat; btn.setAttribute('aria-pressed', state.category===value?'true':'false'); btn.textContent=cat; btn.addEventListener('click',()=>{ state.category=value; [...chipRow.children].forEach(c=> c.setAttribute('aria-pressed','false')); btn.setAttribute('aria-pressed','true'); persist(); render(); }); chipRow.appendChild(btn); }); }

  function buildSuggestions(indexTokens,q){ const qn=normalizeText(q); const sugBox=document.getElementById('suggestions'); const sugList=sugBox.querySelector('ul'); if(!qn){ sugBox.setAttribute('aria-expanded','false'); sugList.innerHTML=''; return;} const parts=tokenize(qn); const candidates=new Set(); indexTokens.forEach(tok=>{ if(parts.some(p=> tok.startsWith(p)||p.startsWith(tok)|| levenshtein(p,tok)<=Math.max(1,Math.floor(p.length*0.25)))) candidates.add(tok); }); const arr=Array.from(candidates).slice(0,12); sugList.innerHTML=arr.map((t,i)=> `<li role="option" data-i="${i}">${t}</li>`).join(''); sugBox.setAttribute('aria-expanded', arr.length>0?'true':'false'); }

  function buildNearTerms(indexTokens,parts){ const near=[]; const sugBox=document.getElementById('nearTerms'); for(const p of parts){ let best=indexTokens.map(tok=>({tok,d:levenshtein(p,tok)})).sort((a,b)=>a.d-b.d).slice(0,2).map(x=>x.tok); near.push(...best);} const uniq=Array.from(new Set(near)).slice(0,3); sugBox.innerHTML=''; uniq.forEach(t=>{ const b=document.createElement('button'); b.className='chip'; b.textContent=t; b.addEventListener('click',()=>{ document.getElementById('searchInput').value=t; state.q=t; persist(); render(); }); sugBox.appendChild(b); }); }

  // ====== Render ======
  function statePillHTML(est){ const active = normalizeText(est)==='activo'; const label=active?'Activo':'Inactivo'; return `<svg width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" style=\"vertical-align:middle\"><circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"${active?'#61BF1A':'#9E9E9E'}\"/></svg> ${label}`; }
  function svgOpen(){ return '<svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M14 3h7v7h-2V6.41l-9.29 9.3-1.42-1.42 9.3-9.29H14V3z"/></svg>'; }
  function svgLink(){ return '<svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M3.9 12a5 5 0 0 1 5-5h3v2h-3a3 3 0 1 0 0 6h3v2h-3a5 5 0 0 0 0-10z"/></svg>'; }
  function svgCopy(){ return '<svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z"/></svg>'; }
  function svgPause(){ return '<svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>'; }

  function copyText(text,notify){ if(navigator.clipboard&&navigator.clipboard.writeText){ navigator.clipboard.writeText(text).then(()=> toast(notify)).catch(()=> fallbackCopy(text,notify)); } else { fallbackCopy(text,notify);} }
  function fallbackCopy(text,notify){ const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); toast(notify);}catch(e){} document.body.removeChild(ta);} 
  function toast(msg){ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.bottom='18px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='var(--green-600)'; t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='10px'; t.style.boxShadow='var(--shadow)'; t.style.zIndex=60; document.body.appendChild(t); setTimeout(()=>{ t.remove(); }, 1400); }

  function render(){ const grid=document.getElementById('grid'); const empty=document.getElementById('emptyState');
    const qApplied=applyCorrections(state.q); const tokensBase=tokenize(qApplied); const tokens=expandSynonyms(tokensBase);
    let list=DASH_DATA.slice();
    if(state.category){ list=list.filter(d=> (d.dominio||d.categoria)===state.category); }
    if(state.onlyActive){ list=list.filter(d=> normalizeText(d.estado)==='activo'); }
    let scored=list.map(it=>({item:it,...scoreItem(it,tokens)})); if(tokens.length>0){ scored=scored.filter(x=> x.score>0); }
    scored.sort((a,b)=> a.item.nombre.localeCompare(b.item.nombre));

    grid.innerHTML='';
    if(scored.length===0){ empty.style.display='block'; buildNearTerms(INDEX, tokensBase); return; } else { empty.style.display='none'; }

    scored.forEach(({item})=>{ const card=document.createElement('div'); card.className='card'+(normalizeText(item.estado)!=='activo'?' inactivo':'');
      const head=document.createElement('div'); head.className='card-header';
      const h=document.createElement('h3'); h.className='card-title'; h.textContent=item.nombre; head.appendChild(h);
      const pill=document.createElement('span'); pill.className='badge '+(normalizeText(item.estado)==='activo'?'activo':'inactivo'); pill.innerHTML=statePillHTML(item.estado); head.appendChild(pill);
      card.appendChild(head);
      const desc=document.createElement('div'); desc.textContent=item.descripcion||''; card.appendChild(desc);
      const meta=document.createElement('div'); meta.className='meta';
      const m1=document.createElement('span'); m1.className='meta-line'; m1.textContent='üìÅ Dominio: '+(item.dominio||item.categoria||'');
      const m2=document.createElement('span'); m2.className='meta-line'; m2.textContent='üë§ Desarrollador: '+(item.desarrollador||item.owner||'N/A');
      const m3=document.createElement('span'); m3.className='meta-line'; m3.textContent='ü§ù Patrocinador: '+(item.patrocinador||'N/A');
      if(item.accesosBase) { const m4=document.createElement('span'); m4.className='meta-line'; m4.textContent='üîê Accesos Base: '+item.accesosBase; meta.appendChild(m4); }
      if(item.suscripcion) { const m5=document.createElement('span'); m5.className='meta-line'; m5.textContent='üîî Suscripci√≥n: '+item.suscripcion; meta.appendChild(m5); }
      meta.appendChild(m1); meta.appendChild(m2); meta.appendChild(m3); card.appendChild(meta);
      const tags=document.createElement('div'); tags.className='tags'; ((item.tags||[])).forEach(t=>{ const s=document.createElement('span'); s.className='tag'; s.textContent=t; tags.appendChild(s); }); card.appendChild(tags);
      const actions=document.createElement('div'); actions.className='actions';
      if(item.url){ const aOpen=document.createElement('a'); aOpen.className='btn btn-primary btn-sm'; aOpen.href=item.url; aOpen.target='_blank'; aOpen.rel='noopener'; aOpen.innerHTML=svgOpen()+' Abrir dashboard'; actions.append(aOpen); }
      const bCopy=document.createElement('button'); bCopy.className='btn btn-ghost btn-sm'; bCopy.innerHTML=svgLink()+' Copiar enlace'; bCopy.addEventListener('click',()=>copyText(item.url||'', 'Enlace copiado'));
      const bFicha=document.createElement('button'); bFicha.className='btn btn-ghost btn-sm'; bFicha.innerHTML=svgCopy()+' Copiar ficha'; bFicha.addEventListener('click',()=>{ const ficha=`Tipo: ${item.tipo||''}\nC√≥digo: ${item.id||item.codigo||''}\nNombre: ${item.nombre}\nDominio: ${item.dominio||item.categoria||''}\nEstado: ${item.estado||''}\nDesarrollador: ${item.desarrollador||item.owner||'N/A'}\nPatrocinador: ${item.patrocinador||'N/A'}\nAccesos Base: ${item.accesosBase||''}\nSuscripci√≥n: ${item.suscripcion||''}\nAcceso: ${item.url||''}\nPalabras Clave: ${(item.tags||[]).join(', ')}`; copyText(ficha,'Ficha copiada'); });
      actions.append(bCopy,bFicha); card.appendChild(actions);
      if(normalizeText(item.estado)!=='activo'){ const paused=document.createElement('div'); paused.className='meta'; paused.innerHTML='<span title="Inactivo">'+svgPause()+' Inactivo</span>'; card.appendChild(paused); }
      grid.appendChild(card); }); }

  // ====== Index din√°mico para sugerencias ======
  let INDEX = [];
  function rebuildIndex(){ const set=new Set(); for(const d of DASH_DATA){ [d.nombre,(d.dominio||d.categoria), (d.patrocinador||d.desarrollador||d.owner), ...(d.tags||[])].forEach(v=>{ (normalizeText(String(v||''))).split(/\s+/).forEach(t=>{ if(t&&t.length>1) set.add(t); }); }); } Object.keys(SYNONYMS).forEach(k=>{ normalizeText(k).split(/\s+/).forEach(t=>{ if(t.length>1) set.add(t); }); SYNONYMS[k].forEach(v=> normalizeText(v).split(/\s+/).forEach(t=>{ if(t.length>1) set.add(t); })); }); INDEX = Array.from(set); }

  // ====== Entradas / UI ======
  const searchInput=document.getElementById('searchInput'); const clearBtn=document.getElementById('clearSearch');
  clearBtn.addEventListener('click',()=>{ searchInput.value=''; state.q=''; persist(); render(); buildSuggestions(INDEX,''); searchInput.focus(); });
  searchInput.addEventListener('input',(e)=>{ state.q=e.target.value; persist(); render(); buildSuggestions(INDEX,state.q); });
  const sugList=document.getElementById('suggestions').querySelector('ul');
  sugList.addEventListener('click',(e)=>{ const li=e.target.closest('li'); if(!li) return; const val=li.textContent; searchInput.value=val; state.q=val; persist(); render(); buildSuggestions(INDEX,''); });

  document.getElementById('fileInput').addEventListener('change', async (e)=>{
    const file = e.target.files?.[0]; if(!file) return; await loadExcel(file); });

  // ====== Excel loading ======
  async function fetchArrayBuffer(url){ const res = await fetch(url); if(!res.ok) throw new Error('No se pudo descargar el Excel'); return await res.arrayBuffer(); }

  function parseWorkbook(wb){ const wsname = EXCEL_SHEET_NAME || wb.SheetNames[0]; const ws = wb.Sheets[wsname]; const rows = XLSX.utils.sheet_to_json(ws, {defval:""});
    // Mapeo de columnas del Excel -> modelo del cat√°logo
    const data = rows.map(r=>{
      const estado = r["Estado"] || r["estado"] || r["ESTADO"] || "";
      return {
        tipo: r["Tipo"] || r["tipo"],
        id: r["C√≥digo"] || r["Codigo"] || r["codigo"],
        codigo: r["C√≥digo"] || r["Codigo"] || r["codigo"],
        nombre: r["Nombre"] || r["nombre"],
        dominio: r["Dominio"] || r["dominio"],
        estado: estado,
        desarrollador: r["Desarrollador"] || r["owner"] || r["Owner"],
        patrocinador: r["Patrocinador"] || r["patrocinador"],
        accesosBase: r["Accesos Base"] || r["Accesos"] || "",
        suscripcion: r["Suscripci√≥n"] || r["Suscripcion"] || "",
        url: r["Acceso"] || r["URL"] || r["Url"] || r["url"],
        descripcion: r["Descripci√≥n"] || r["Descripcion"] || r["descripcion"] || "",
        tags: String(r["Palabras Clave"]||"").split(/[,;|]/).map(x=>x.trim()).filter(Boolean)
      };
    })
    // Filtrar solo Activos
    .filter(d=> normalizeText(d.estado)==='activo');

    return data;
  }

  async function loadExcel(source){ try{
      document.getElementById('loader').style.display='inline';
      const ab = source instanceof File ? await source.arrayBuffer() : await fetchArrayBuffer(source);
      const wb = XLSX.read(ab, {type:'array'});
      DASH_DATA = parseWorkbook(wb);
      DOMAINS = Array.from(new Set(DASH_DATA.map(d=> d.dominio).filter(Boolean)));
      rebuildIndex();
      restore();
      buildChips();
      render();
    } catch(err){ console.error(err); toast('Error cargando Excel'); }
    finally{ document.getElementById('loader').style.display='none'; }
  }

  // ====== Boot ======
  async function boot(){ buildChips(); // inicial vac√≠o
    if(EXCEL_URL){ try{ await loadExcel(EXCEL_URL); } catch(e){ console.warn('Fallo carga por URL'); } }
  }
  document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
